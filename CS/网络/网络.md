
### 什么是TCP/IP四层模型？

四层模型一系列协议所组成的⼀个网络分层模型，分层的原因就是因为网络的不稳定性。在服务器与客户端之间有许多节点，它们可能是交换机、路由器、或者是网关。假如在传输过程中，有一个节点坏掉了，这时候就需要重传一次，但首先客户端需要先知道消息丢了，所以就需要让服务器收到消息后回执，如果在长时间等待后没有收到回执，就说明消息丢掉了，客户端就需要重传一次。

但如果传输的数据比较大，那它传输的时间就越长，出问题的可能性也就更大，如果数据经常重传，就会给人一种网络不稳定的感觉。所以就有了分块传输，分段传输就是把传输的数据分成一段一段并编号后分开来传，假如一个特别长的数据中只有被切开的某一段数据没有回执，那么就只需要重传这一段数据就行了，所需要的传输成本就大大减小了。

因为有了分块传输，所以就需要分层了，因为应用层协议不只HTTP，还有FTP(传文件的)、DNS(做域名服务的)，他们都需要分块传输来提高性能，所以分块传输这个功能就被单独抽出来作为了传输层，这就是TCP(传输控制协议)。

 由于有一些场景的数据不需要重传，比如直播、实时的游戏，比如在直播或游戏过程中，突然有几秒断线了，那这几秒的数据是不需要重传的。因为别人只需要知道你的最新状态是什么，这种协议就是UDP(用户数据包协议)。

 虽然他们两个协议的重传需求不同，但是他们都需要网络，都需要从客户端到服务器，或者从服务器到客户端，所以就抽了一层网络层，而数据的发送及接受与网络层(IP)来进行。

应用层只负责数据的发送与接受，传输层只负责数据的拆分与拼装，网络层只负责数据的发送与接受，数据链路层就是以太网、WiFi，是物理支持。

Application Layer 应用层：[[HTTP]]、FTP、DNS

Transport Layer 传输层：[[TCP]]、[[UDP]]

Internet Layer 网络层：IP

Link Layer 数据链路层：以太网、Wi-Fi



### #长连接

因为移动网络并不在 Internet 中，而是在运营商的内网，并不具有真正的公网 IP， 因此当某个 TCP 连接在⼀段时间不通信之后，网关会出于网络性能考虑而关闭这条 TCP 连接和公网的连接通道，导致这个 TCP 端口不再能收到外部通信消息，即 TCP 连接被动关闭。

实现长连接的方式叫心跳。即在⼀定间隔时间内，使用 TCP 连接发送超短无意义消息来让网关不能将自己定义为「空闲连接」，从而防止网关将自己的连接关闭。
